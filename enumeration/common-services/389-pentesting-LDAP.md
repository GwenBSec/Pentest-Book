## Enumeration 
### nmap 
```bash 
nmap -n -sV --script "ldap* and not brute" <IP>
nmap -p 389 --script ldap-rootdse -Pn 10.10.10.10
```

### anonymous access (anonymous bind) 
```bash
# check for anonymous bind 
ldapsearch -x -H ldap://10.10.10.10 -b "dc=megabank,dc=local"
rpcclient -U "" -N 10.10.10.10 

ldapsearch -x -H ldap://<IP> -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -H ldaps://company.com:636/ -x -s base -b '' "(objectClass=*)" "*" +

# enum domain users
ldapsearch -x -H ldap://10.10.10.10 -b "dc=cascade,dc=local" '(objectClass=Person)' sAMAccountName | grep sAMAccountName
ldapsearch -x -H ldap://10.10.10.10 -b "dc=cascade,dc=local" '(objectClass=User)' sAMAccountName | grep sAMAccountName 
rpcclient> enumdomusers

# check descriptions for creds
rpcclinet> querydispinfo
cat ldap_search.txt | grep -i description 

# output to file
ldapsearch -x -h 192.168.162.122 -b "dc=hutch,dc=offsec" > ldap_search.txt
cat ldap_search.txt | grep -i "samaccountname"   # copy & past into raw_users.txt file
cat raw_users.txt | cut -d: -f2 | tr -d " " > users.txt    # grab usernames



```

### Password Spraying 
```bash
# Kerbrute
kerbrute -domain hutch.offsec -users ./users.txt -dc-ip 192.168.219.122

# crackmapexec
crackmapexec smb 192.168.219.122 -u ./users.txt -p ./passwords.txt --continue-on-success
```

### ldapper 
```bash
https://github.com/Synzack/ldapper
```

